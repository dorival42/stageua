---
title: "Untitled"
author: "Pierre Chrislin DORIVAL"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown
```{r}
library(dplyr)
#install.packages("viridis")
library(viridis)
#install.packages("RColorBrewer")
library(RColorBrewer)
install.packages("fmsb")
library(fmsb)

```

```{r}
db_chlor = parcelles_chlordecone_janv21
db_chlor
```
```{r}
db_chlor = parcelles_chlordecone_janv21
# Extraire la première ligne comme noms de colonnes
noms_colonnes <- as.character(db_chlor[1, ])

# Remplacer les noms de colonnes
colnames(db_chlor) <- noms_colonnes

# Supprimer la première ligne des données
db_chlor <- db_chlor[-1, ]

rownames(db_chlor) <- NULL

# Afficher les premières lignes des données avec les nouveaux noms de colonnes
head(db_chlor)

```
```{r}
# Compter le nombre de valeurs NA dans la colonne COMMU_LAB
nb_na <- sum(is.na(db_chlor$COMMU_LAB))
nb_na



```




```{r}
colnames(db_chlor)
```
```{r}
db_chlor$COMMU_LAB[is.na(db_chlor$COMMU_LAB)] <- "COMMU_UN"
db_chlor <- subset(db_chlor, COMMU_LAB != "COMMU_UN")
supprimer_colonnes_na <- function(data) {
  # Identifier les colonnes avec au moins une valeur NA
  colonnes_a_supprimer <- names(data)[apply(data, 2, function(x) any(is.na(x)))]
  
  # Supprimer les colonnes identifiées
  data <- data[, !(names(data) %in% colonnes_a_supprimer)]
  
  return(data)
}



new_db_chlor <- supprimer_colonnes_na(db_chlor)


# Afficher les premières lignes des données après suppression des colonnes
new_db_chlor


```
```{r}

# Preparation des donnees
colnames(new_db_chlor)[colnames(new_db_chlor) == "pluviom\xe9trie_moyenne_annuelle"] <- "pluviometrie_moyenne_annuelle"
colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_mean"] <- "mnt.rugosite_mean"
colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_median"] <- "mnt.rugosite_median"
colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_stdev"] <- "mnt.rugosite_stdev"
colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_min"] <- "mnt.rugosite_min"
colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_max"] <- "mnt.rugosite_max"
colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_minority"] <- "mnt.rugosite_minority"
colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_majority"] <- "mnt.rugosite_majority"

colnames(new_db_chlor)[colnames(new_db_chlor) == "mnt.rugosit\xe9_variance"] <- "mnt.rugosite_variance"
colnames(new_db_chlor)[colnames(new_db_chlor) == "Ann\xe9e"] <- "Annee"

# Parcourir les colonnes du dataframe
for (colonne in colnames(new_db_chlor)) {
  # Vérifier si la colonne est de type caractère
  if (class(new_db_chlor$colonne) == "character") {
    # Remplacer les virgules par des points décimaux dans la colonne
    new_db_chlor$colonne <- gsub(",", ".", new_db_chlor$colonne)
  }
}
# Remplacer les virgules par des points décimaux dans la colonne 
new_db_chlor$Taux_chlordecone <- gsub(",", ".", new_db_chlor$Taux_chlordecone)

new_db_chlor$pluviometrie_moyenne_annuelle <- gsub("-", "+", new_db_chlor$pluviometrie_moyenne_annuelle)

new_db_chlor <- new_db_chlor[, !colnames(new_db_chlor) %in% c("Numero_sig", "ocs_gid", "ocs_code_us","Adresse_parcelle","ocs_ossature","ocs_id","ocs_code_cs","ocs_millesime","ocs_source","ocs_id_origine","ocs_code_or","Interet","Annee", "Origine_donnee","Code_insee_parcelle","Parcelle_cadastrale","Methode_prelevement")]

# transformer les donnees dans la colonnes pulviometrie
moyennes <- numeric(length(new_db_chlor$pluviometrie_moyenne_annuelle))

# Diviser chaque valeur et calculer la moyenne
for(i in 1:length(new_db_chlor$pluviometrie_moyenne_annuelle)) {
    # Diviser la valeur en deux parties en utilisant le symbole '+'
    valeurs <- strsplit(new_db_chlor$pluviometrie_moyenne_annuelle[i], "\\+")
    # Convertir les parties en nombres et calculer la moyenne
    moyennes[i] <- mean(as.numeric(unlist(valeurs)))
}

# Ajouter la colonne de moyennes au jeu de données
new_db_chlor$moyenne_pulviometrie <- moyennes

new_db_chlor <- new_db_chlor[, !colnames(new_db_chlor) %in% c("Numero_sig", "ocs_gid", "ocs_code_us","Adresse_parcelle","ocs_ossature","ocs_id","ocs_code_cs","ocs_millesime","ocs_source","ocs_id_origine","ocs_code_or","Interet","Annee", "Origine_donnee","Code_insee_parcelle","Parcelle_cadastrale","Methode_prelevement", "pluviometrie_moyenne_annuelle")]


# Écrire les données modifiées dans un nouveau fichier CSV
write.csv(new_db_chlor, "new_db_chlordecone.csv", row.names = FALSE)

```
```{r}

nlle_table <- new_db_chlordecone[, c("COMMU_LAB", "mnt.exposition_mean", "mnt.ombrage_mean","mnt.tri_mean","mnt.tpi_mean","Taux_chlordecone")] 
nlle_table$Taux_chlordecone <- as.numeric(nlle_table$Taux_chlordecone)

#nlle_table$mnt.ombrage_mean <- as.numeric(nlle_table$mnt.ombrage_mean)
nlle_table



```

```{r}
# Analyse statistiques


data_commu <- new_db_chlordecone[, c("COMMU_LAB", "Taux_chlordecone")]

# Agrégation des données par commune (calcul de la moyenne)
mean_commu <- aggregate(Taux_chlordecone ~ COMMU_LAB, data = data_commu, FUN = mean)



# Génération de 35 couleurs distinctes à partir de la palette
couleurs <- rainbow(35)
# Création du graphique (exemple avec un diagramme en barres)
barplot(mean_commu$Taux_chlordecone, 
        names.arg = mean_commu$COMMU_LAB, 
        col = couleurs, # Utilisation des couleurs variables
        xlab = "Commune", 
        ylab = "Taux moyen de chlordecone",
        main = "Répartition des taux de chlordecone par commune")

legend("topright", 
       legend = mean_commu$COMMU_LAB, 
       fill = couleurs, 
       title = "Communes",
       text.col = "black",   
       cex = 0.1) 
```
```{r}
unique(new_db_chlordecone$COMMU_LAB)
```

```{r}
# Création du graphique boxplot avec les données des taux de chlordecone par commune
boxplot(Taux_chlordecone ~ COMMU_LAB, data = data_commu, 
        xlab = "Commune", 
        ylab = "Taux de chlordecone",
        main = "Répartition des taux de chlordecone par commune")


```
```{r}
pie(mean_commu$Taux_chlordecone, 
    labels = mean_commu$COMMU_LAB,
```


```{r}
main = "Répartition des taux de chlordecone par commune")
```
        



```{r}
hist(mean_commu$Taux_chlordecone, 
     xlab = "Taux de chlordecone",
     ylab = "Fréquence",
     main = "Distribution des taux de chlordecone")
```
```{r}
colnames(new_db_chlordecone)
```

